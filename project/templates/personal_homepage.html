
  {% extends "base.html" %}
  {% block title %}Q系统{% endblock %}
  {% block head %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="/static/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
  <link href="/static/css/datetimepicker.css" rel="stylesheet" media="screen">
  <link href="/static/css/tankuang.css" rel="stylesheet" media="screen">
  <link href="/static/css/homepage.css" rel="stylesheet" media="screen">
  {% endblock %}
  {% block content %}
  <body id="mybody">

  <!-- Button trigger modal -->   
   
  {% if messages %}
  
   {% if count = 1 %}
	<div style="height:120px; padding-left: 10px; padding-top: 10px;" class="notice">
   {% endif %}   
   {% if count = 2 %}
	<div style="height:120px; padding-left: 10px; padding-top: 10px;" class="notice">
   {% endif %} 
   {% if count = 3 %}
	<div style="height:120px; padding-left: 10px; padding-top: 10px;" class="notice">
   {% endif %} 
   
    {% if count >= 4 %}
	<div style="height:140px; padding-left: 10px; padding-top: 10px;" class="notice" >
   {% endif %} 
   
		<div class="notice_title">
			<span>
				<b>消息提醒<span style="color:#ffa03e">({{count}}):</span></b>
			</span>
		</div>
			
	 <div style="width:850px" class="notice_content">		

 
     {% for item in messages %}
       
        <p><a href="/historymessage/" target="_blank" style="text-overflow: ellipsis;display: inline-block;overflow: hidden;white-space: nowrap;width: 800px;">{{item.content}}</a></p>
    
      {% endfor %}
   		
		 </div>								
		<div style="position:absolute;right:10px;bottom:0">
			<a href="/historymessage/" style="color:#339666">查看历史记录</a>
		</div>		
	</div>	
  {% else %}
  <div style="height:25px; padding-left: 10px; padding-top: 10px;" class="notice">
  <div class="notice_title">
			<span>
				<b>消息提醒<span style="color:#ffa03e">(0):</span></b>
			</span>
		</div>
		
    <p>暂无消息</p>
   </div>	
  {% endif %}
 
   {% if j = 1 %}
    <div style="padding:50px 0 15px">
    <a href="/delay/" style="color:#339666" target="_blank">查看您要处理的延期申请>></a>
    </div>  
   {% endif %}
  
  
  <div style="width:100%; height:25px;margin-bottom: 10px;margin-top: 10px;">
    <div style="float:left;">
    <b>我参与的项目:</b>
    <input type="radio" class="btn btn-default" id="smalltable" name="changet">小鸟依人版
    <input type="radio" class="btn btn-default" id="bigtable" name="changet" checked="checked">大气版 
    {% if perms.project.can_change_project%}
    <p>我有<p>
    {% endif %}
    </div>
  </div>

<div id="x-table2">
    <div style="margin:3px 0px">
      <div style=""class="tabbable">
      <!-- Only required for left/right tabs -->
          <ul class="nav nav-tabs" style="display:block;background-color:#339966"> 
            <li class="active"><a href="#tab1" data-toggle="tab" style="color:#000">进行中的项目</a></li>
            <li><a href="#tab2" data-toggle="tab" style="color:#000">已完结的项目</a></li>
          </ul> 
          <div class="tab-content" style="padding:0px">
            <div class="tab-pane active" id="tab1">
              
              <table  id="customers">
                <thead>
                  {% if not projectobj %}
                      <p style="text-align:center;">暂无相关项目</p>
                  {% else %}
                  <tr>
                    <th style="width:50px;">优先级</th>
                    <th style="width:137px;">项目名称</th>
                    <th style="width:76px">项目负责人</th>
                    <th style="width:69px">产品负责人</th>
                    <th style="width:70px">测试负责人</th>
                    <th style="width:134px">项目成员</th>
                    <th style="width:82px">项目开始时间</th>
                    <th style="width:82px">计划上线时间</th>
                    <th style="width:82px">实际上线时间</th>
                    <th style="width:76px">项目状态</th>
                    <th style="width:236px">操作</th>
                  </tr>
                <thead>
                <tbody id="group_one">
                  
                      {% for res in projectobj %}                                 
                  <tr>               
                    <td>{{res.priority}}</td>
                    <td><a href="{% url 'prodetail' res.id %}">{{res.project}}</a>
                    <td>{{res.leader_p.realname}}</td>
                    <td>{{res.designer_p.realname}}</td>
                    <td>{{res.tester_p.realname}}</td>
                    <td>                       
                    
                    {% for u in puser %}
                    {% ifequal res.id u.project_id %}                                                        
                    {{u.username.realname}}&nbsp;
                    {% endifequal %}
                    {% endfor %}                  

                    </td>
                    <td>{{res.start_date|date:"Y-m-d"}}</td>
                    <td>{{res.expect_launch_date|date:"Y-m-d"}}</td>
                    <td>{{res.real_launch_date|date:"Y-m-d"}}</td>
                    <td>{{res.status_p}}</td>
                    <td>
                      {% if c = 1 %}                           
                      <a onclick="change_p({{res.id}})">设计变更</a><span>|</span>
                      {% else %}
                                                                              设计变更<span>|</span>
                      {% endif %}
                       
                      {% if d = 1 %}
                      <a href="{% url 'editproject' res.id %}">编辑<span>|</span></a>
                      {% else %}
                                                                                编辑<span>|</span>
                      {% endif %}
                      
                      {% if m = 1 %}
                      <a onclick="delay_p({{res.id}},{{res.expect_launch_date|date:"Ymd"}})">延期<span>|</span></a>
                      {% else %}
                                                                           延期<span>|</span>
                      {% endif %}
                      
                      {% if n = 1 %}
                      <a href="{% url 'project_pause' res.id %}" onclick="return confirm('你确定要暂停项目吗?')">暂停<span>|</span></a>
                      {% else %}
                                                                               暂停<span>|</span>
                      {% endif %}
                       
                       {% if k = 1 %}
                      <a href="{% url 'project_delete' res.id %}" onclick="return confirm('你确认要删除吗?')">删除<span></span></a>
                      {% else %}
                                                                               删除<span></span>
                      {% endif %}
                      
                    </td>                   
                  </tr>
                 
                  {% endfor %}
                  {% endif %}                 
                </tbody>
              </table>
              <p></p>
            </div> 
            <div class="tab-pane" id="tab2">
              <table id="customers">
                <thead>
                  {% if not result1 %}
                      <p style="text-align:center;">暂无相关项目</p>
                  {% else %}
                <tr>
                  <th style="width:50px;">优先级</th>
                  <th style="width:137px;">项目名称</th>
                  <th style="width:76px">项目负责人</th>
                  <th style="width:69px">产品负责人</th>
                  <th style="width:70px">测试负责人</th>
                  <th style="width:134px">项目成员</th>
                  <th style="width:82px">项目开始时间</th>
                  <th style="width:82px">计划上线时间</th>
                  <th style="width:82px">实际上线时间</th>
                  <th style="width:82px">项目状态</th>
                  <th style="width:236px">操作</th>
                </tr>
              </thead>

              <tbody id="group_one">
                {% for pres in result1 %}                                          
                  <tr>                    
                    <td>{{pres.priority}}</td>
                    <td><a href="{% url 'prodetail' pres.id %}">{{pres.project}}</a>
                    <td>{{pres.leader_p.realname}}</td>
                    <td>{{pres.designer_p.realname}}</td>
                    <td>{{pres.tester_p.realname}}</td>
                    <td>                                                                
                    
                    {% for us in puser %}
                    {% ifequal pres.id us.project_id %}                                                        
                    {{us.username.realname}}&nbsp;
                    {% endifequal %}
                    {% endfor %}                  

                    </td>
                    <td>{{pres.start_date|date:"Y-m-d" }}</td>
                    <td>{{pres.expect_launch_date|date:"Y-m-d"}}</td>
                    <td>{{pres.real_launch_date|date:"Y-m-d"}}</td>
                    <td>{{pres.status_p}}</td>     
                  <td>
                    <a href="{% url 'prodetail' pres.id %}">查看详情</a>
                  </td>
                  {% endfor %}
                  {% endif %}
                </tr>
                
              </tbody>
              </table>
              <p> </p>
            </div>  
        </div>
      </div>
    </div>
  </div>

  <!--分页-->
    <div class="pagination" style="text-align:right;margin-right:10px">
    <span class="step-links"  >
        {% if projectobj.has_previous %}
            <a href="?page={{ projectobj.previous_page_number }}"> << </a>
        {% endif %}

        <span class="current">
            第 {{ projectobj.number }} 页共 {{ projectobj.paginator.num_pages }}页
        </span>

        {% if projectobj.has_next %}
            <a href="?page={{ projectobj.next_page_number }}"> >> </a>
        {% endif %}
    </span>
    </div>

 {% include "pauseproject.html" %}

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <form name="test" class="navbar-form navbar-center" action="/changedesign/" method='post' id="test">
      <div class="mymodal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">设计变更</h4>
      </div>
      <div class="modal-body">
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span3">
             <div class="title">
                <label class="item-title">
                变更内容：
                </label>
        </div>
         <div class="title">
                <label class="item-title">
                设计图地址：
                </label>
        </div>

    </div>
    <div class="span9">
     
       <div> <textarea  name="cont" type="text" class="form-control inputfield" style="width:300px; background-color: #FFFFFF; vertical-align: middle; margin-top: 8px;" maxlength="500" onchange="this.value=this.value.substring(0, 500)" onkeydown="this.value=this.value.substring(0, 500)" onkeyup="this.value=this.value.substring(0, 500)"></textarea> 
       </div>
     <div> <textarea name="dpath" type="text" class="form-control inputfield" style="width:300px; background-color: #FFFFFF; vertical-align: middle; margin-top: 0px;" maxlength="500" onchange="this.value=this.value.substring(0, 500)" onkeydown="this.value=this.value.substring(0, 500)" onkeyup="this.value=this.value.substring(0, 500)"></textarea> 
     </div>    

        <input id="changeid" name="changeid" type="hidden">
    </div>
  </div>
</div>
    </div>
      <div class="modal-footer">
        <div align="center">
          <button type="button" class="btn mybtn-success"  onclick="return chk();">确定</button>
          <button type="button" class="btn btn-default" data-dismiss="modal" >取消</button>
        </div>
      </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

 

   
  </body>      
{% endblock %}
{% block js %}
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>    
    <script type="text/javascript" src="/static/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript" src="/static/js/home_page.js"></script>     
    <script type="text/javascript">     
      function change_p(id){
        $('#changeid').val(id);
        $('#myModal').modal('show');
      }
      function delay_p(id,time){
        $('#delayid').val(id);
        $('#protime').val(time);
        $('#myModal1').modal('show');
      }
      function chk(){
        var chcontent = document.test.cont.value;
        var chdpath = document.test.dpath.value;
        if(!chcontent||!chdpath){
          alert('变更内容或设计图路径不能为空');
        }
        else{
          document.test.submit();
        } 
      }
      function chkdelay(){
        var delaytime = document.test1.delay_date.value;
        var delayreason = document.test1.delay_reason.value;
        if(!delaytime||!delayreason){
          alert('延期日期或者延期理由不能为空');
        }
        else{
          document.test1.submit();
        } 
      }
    </script>    
{% endblock %}
